# simple_gRPC

4 types of gRPC communication in Golang [blog](https://medium.com/@LogeshSakthivel/4-types-of-grpc-communication-in-golang-c395df1f3cff)

This article is all about working with the 4 types of gRPC communications in Golang.

Implementing both the gRPC Server and the gRPC Client in Golang.

## Prerequisite

- Basic understanding of [Protobuf](https://medium.com/@LogeshSakthivel/protocol-buffers-basics-d5668fc194b3) and [gRPC](https://medium.com/@LogeshSakthivel/grpc-general-purpose-rpc-basics-3a5b8c637fa7).
- [Protoc installation](https://medium.com/@LogeshSakthivel/installing-protobuf-compiler-protoc-536e7770e13b).

## Prepare the proto file

As a first step, we have to prepare our proto file. Define the message types and then the services and its rpc methods with the request message type and the response message types.

To make this article simpler, I have simplified the messages and the RPC services defined in the proto file.

This Four gRPC modes [repo](https://github.com/LogeshVel/four_gRPC_modes) contains the `simple.proto` that has:

- 2 Message types
  - SimpleRequest — has the string field request_need
  - SimpleResponse — has the string field response
- 1 Service
  - SimpleService — this simple service has the four types of gRPC communication defined in it.
- 4 RPCs for that Service
  - RPCRequest — Unary RPC, simple request/response model.
  - ServerStreaming — Server Streaming RPC where the client sends a request to the server and gets a stream to read a sequence of messages back. You specify a response-streaming method by placing the stream keyword before the response type.
  - ClientStreaming — Client Streaming RPC where the client writes a sequence of messages and sends them to the server. Once the client has finished writing the messages, it waits for the server to read them all and return its response. You specify a request-streaming method by placing the stream keyword before the request type.
  - StreamingBiDirectional — Bidirectional Streaming RPC where both sides send a sequence of messages using a read-write stream. The two streams operate independently, so clients and servers can read and write in whatever order they like(depends on the implementation). You specify this type of method by placing the stream keyword before both the request and the response.
- Also, specified the go package option (simple/testgrpc)

## Compiling the proto file

Now, proceed to compiling the proto file to Golang pb file and Golang grpc file.

Single proto file is compiled to 2 Golang files (one has the messages i.e. pb file and the other has the RPCs i.e gRPC file)

For compiling proto file to PB file we need protoc-gen-go plugin and to grpc file we need protoc-gen-go-grpc plugin.

Install this two plugins using the below command.

- `go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28`
- `go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2`

And update your $PATH with the $GOPATH/bin

This plugin will be installed in the $GOPATH/bin by updating the $PATH var with this path, protoc can find the plugins.

Command to compile the proto file,

`protoc --go_out=. --go-grpc_out=. simple.proto`

This generates the Go pb file and the Go grpc file.

And the Go files generated by compiling the proto file.

- simple.pb.go \- contains the pb messages
- simple_grpc.pb.go \- contains the gRPC Service and methods

## complete server/client code

1. server code: `cmd/simplerpc-server/server.go`
1. client code: `cmd/simplerpc-server/client.go`

## running and logs

1. start server: `go run cmd/simplerpc-server/server.go`
1. start client: `go run cmd/simplerpc-client/client.go`

```sh
❯ go run cmd/simplerpc-server/server.go
2022/06/11 10:39:44 Listening at  127.0.0.1:2008
2022/06/11 10:40:22 Unary request
2022/06/11 10:40:22 Request - request_need:"To test!"
2022/06/11 10:40:22 Response - response:"Here is your response"
2022/06/11 10:40:22 ClientStreaming RPC
2022/06/11 10:40:22 Request - request_need:"Request number : 1"
2022/06/11 10:40:22 Request - request_need:"Request number : 2"
2022/06/11 10:40:22 Request - request_need:"Request number : 3"
2022/06/11 10:40:22 Request - request_need:"Request number : 4"
2022/06/11 10:40:22 Request - request_need:"Request number : 5"
2022/06/11 10:40:22 Request - request_need:"Request number : 6"
2022/06/11 10:40:22 Request - request_need:"Request number : 7"
2022/06/11 10:40:22 Request - request_need:"Request number : 8"
2022/06/11 10:40:22 Request - request_need:"Request number : 9"
2022/06/11 10:40:22 Response - response:"Here is your response"
2022/06/11 10:40:22 ServerStreaming RPC
2022/06/11 10:40:22 Request- request_need:"Need stream response"
2022/06/11 10:40:22 Response - Here is the response 1
2022/06/11 10:40:22 Response - Here is the response 2
2022/06/11 10:40:22 Response - Here is the response 3
2022/06/11 10:40:22 Response - Here is the response 4
2022/06/11 10:40:22 Response - Here is the response 5
2022/06/11 10:40:22 Response - Here is the response 6
2022/06/11 10:40:22 Response - Here is the response 7
2022/06/11 10:40:22 Response - Here is the response 8
2022/06/11 10:40:22 Response - Here is the response 9
2022/06/11 10:40:22 StreamingBiDirectional RPC
2022/06/11 10:40:22 Request - request_need:"My request 1"
2022/06/11 10:40:22 Response - Response for your request - My request 1
2022/06/11 10:40:22 Request - request_need:"My request 2"
2022/06/11 10:40:22 Response - Response for your request - My request 2
2022/06/11 10:40:22 Request - request_need:"My request 3"
2022/06/11 10:40:22 Response - Response for your request - My request 3
2022/06/11 10:40:22 Request - request_need:"My request 4"
2022/06/11 10:40:22 Response - Response for your request - My request 4
2022/06/11 10:40:22 Request - request_need:"My request 5"
2022/06/11 10:40:22 Response - Response for your request - My request 5
2022/06/11 10:40:22 Request - request_need:"My request 6"
2022/06/11 10:40:22 Response - Response for your request - My request 6
2022/06/11 10:40:22 Request - request_need:"My request 7"
2022/06/11 10:40:22 Response - Response for your request - My request 7
2022/06/11 10:40:22 Request - request_need:"My request 8"
2022/06/11 10:40:22 Response - Response for your request - My request 8
2022/06/11 10:40:22 Request - request_need:"My request 9"
2022/06/11 10:40:22 Response - Response for your request - My request 9
2022/06/11 10:40:22 Request - request_need:"My request 10"
2022/06/11 10:40:22 Response - Response for your request - My request 10
```

```sh
❯ go run cmd/simplerpc-client/client.go
2022/06/11 10:40:22 Connected to  127.0.0.1:2008
2022/06/11 10:40:22 Making Unary Request
2022/06/11 10:40:22 Request - request_need:"To test!"
2022/06/11 10:40:22 Response - response:"Here is your response"
2022/06/11 10:40:22 Client Streaming
2022/06/11 10:40:22 Request - Request number : 1
2022/06/11 10:40:22 Request - Request number : 2
2022/06/11 10:40:22 Request - Request number : 3
2022/06/11 10:40:22 Request - Request number : 4
2022/06/11 10:40:22 Request - Request number : 5
2022/06/11 10:40:22 Request - Request number : 6
2022/06/11 10:40:22 Request - Request number : 7
2022/06/11 10:40:22 Request - Request number : 8
2022/06/11 10:40:22 Request - Request number : 9
2022/06/11 10:40:22 Response - response:"Here is your response"
2022/06/11 10:40:22 Server Streaming
2022/06/11 10:40:22 Request - request_need:"Need stream response"
2022/06/11 10:40:22 Response - response:"Here is the response 1"
2022/06/11 10:40:22 Response - response:"Here is the response 2"
2022/06/11 10:40:22 Response - response:"Here is the response 3"
2022/06/11 10:40:22 Response - response:"Here is the response 4"
2022/06/11 10:40:22 Response - response:"Here is the response 5"
2022/06/11 10:40:22 Response - response:"Here is the response 6"
2022/06/11 10:40:22 Response - response:"Here is the response 7"
2022/06/11 10:40:22 Response - response:"Here is the response 8"
2022/06/11 10:40:22 Response - response:"Here is the response 9"
2022/06/11 10:40:22 Bi-Directional Streaming
2022/06/11 10:40:22 Request - My request 1
2022/06/11 10:40:22 Response - response:"Response for your request - My request 1"
2022/06/11 10:40:22 Request - My request 2
2022/06/11 10:40:22 Response - response:"Response for your request - My request 2"
2022/06/11 10:40:22 Request - My request 3
2022/06/11 10:40:22 Response - response:"Response for your request - My request 3"
2022/06/11 10:40:22 Request - My request 4
2022/06/11 10:40:22 Response - response:"Response for your request - My request 4"
2022/06/11 10:40:22 Request - My request 5
2022/06/11 10:40:22 Response - response:"Response for your request - My request 5"
2022/06/11 10:40:22 Request - My request 6
2022/06/11 10:40:22 Response - response:"Response for your request - My request 6"
2022/06/11 10:40:22 Request - My request 7
2022/06/11 10:40:22 Response - response:"Response for your request - My request 7"
2022/06/11 10:40:22 Request - My request 8
2022/06/11 10:40:22 Response - response:"Response for your request - My request 8"
2022/06/11 10:40:22 Request - My request 9
2022/06/11 10:40:22 Response - response:"Response for your request - My request 9"
2022/06/11 10:40:22 Request - My request 10
2022/06/11 10:40:22 Response - response:"Response for your request - My request 10"
```
